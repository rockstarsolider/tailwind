<!DOCTYPE html>
<html id="html" lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../output.css" rel="stylesheet">
    <script src="./dashboard.js"></script>
    <title>داشبورد</title>
</head>
<body class="font-[yekan]" dir="rtl">

    <!-- Side Bar -->
    <ul id="sidebar" class="menu bg-base-300 h-screen w-64 md:w-72 fixed hidden">
        <li class="mr-1 font-bold text-xl py-5">داشبورد</li>

        <li class="text-lg"><a href="./"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            خانه</a></li>
        <li class="text-lg"><a href="./newtask.html"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            تسک جدید</a></li>
        <li class="text-lg"><a href="./prevtasks.html"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            تسک های قبلی</a></li>
        <li class="text-lg"><a href="./time.html"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            زمان و حضور در جلسات</a></li>
        <li class="text-lg"><a href="./pricing.html"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
            خرید اشتراک</a></li>
        <li class="text-lg"><a href="./teammates.html"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            هم تیمی ها</a></li>
        <li class="text-lg rounded-lg bg-neutral text-white"><a href="./setting.html"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
            تنظیمات</a></li>
    </ul>

    <div dir="ltr" class="w-full ">
        <!-- Header -->
        <div id="header" dir="ltr" class="h-16 z-20 shadow-md bg-base-100 flex justify-between items-center md:px-12 px-3 w-[100%] fixed">
            <div class="avatar online placeholder">
                <div class="bg-neutral text-neutral-content rounded-full w-12">
                  <span class="text-xl">AI</span>
                </div>
            </div>
            <div class="md:gap-8 gap-4 flex items-center justify-center" dir="rtl">
                <label id="menu" class="btn btn-circle btn-neutral swap swap-rotate ">
                    <input type="checkbox" />
                    <svg class="swap-off fill-current" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 512 512"><path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z"/></svg>
                    <svg class="swap-on fill-current" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 512 512"><polygon points="400 145.49 366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49"/></svg>
                </label>
                <p id="nameLoc" class="text-lg font-bold"></p>
                <p class="text-lg font-bold">امتیاز: 18</p>
            </div>
        </div>

        <!-- Content -->
        <div dir="rtl" id="content" class="md:px-12 px-3 w-[100%] pt-28 flex md:flex flex-col items-start md:justify-start justify-center gap-6 max-w-[85]rem">
            <p class="card-title">تکمیل یا تغییر حساب کاربری</p>
            <form id="form" class=" w-[100%] flex md:flex flex-col items-start md:justify-start justify-center gap-6">
                <input dir="rtl" id="first_name" name="first_name" type="text" placeholder="نام" class="input input-bordered w-full max-w-xs" />
                <input dir="rtl" id="last_name" name="last_name" type="text" placeholder="نام خانوادگی" class="input input-bordered w-full max-w-xs" />
                <input dir="rtl" id="email" name="email" type="email" placeholder="ایمیل" class="input input-bordered w-full max-w-xs" />
                <input dir="rtl" id="age" name="age" type="number" placeholder="سن" class="input input-bordered w-full max-w-xs" />
                <select name="province" class="select select-bordered w-full max-w-xs text-base">
                    <option disabled selected>انتخاب شهر</option>
                    <option>تهران</option>
                    <option>شیراز</option>
                    <option>مشهد</option>
                </select>
                <button type="submit" class="btn btn-neutral mb-5">ثبت تغییرات</button>
            </form>

            <p class="card-title mt-5">تغییر تم</p>
            <label class="flex cursor-pointer gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/></svg>
                <input id="themeController" type="checkbox" value="dark" class="toggle theme-controller"/>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </label>

            <div dir="ltr" class="diff aspect-[16/9] w-full max-w-[30rem] rounded-lg border border-base-300">
                <div class="diff-item-1">
                    <div data-theme="light" class="  text-9xl flex flex-col items-end justify-start p-5 pr-12 gap-3">
                        <p class="card-title">تفاوت حالت روشن و تاریک</p>
                        <button class="btn ">دکمه</button>
                        <input dir="rtl" type="text" placeholder="بنویسید" class="input input-bordered w-full max-w-xs" />
                        <input type="checkbox" checked="checked" class="checkbox" />
                    </div>
                </div>
                <div class="diff-item-2">
                    <div data-theme="dark" class=" text-9xl flex flex-col items-end justify-start p-5 pr-12 gap-3">
                        <p class="card-title">تفاوت حالت روشن و تاریک</p>
                        <button class="btn ">دکمه</button>
                        <input dir="rtl" type="text" placeholder="بنویسید" class="input input-bordered w-full max-w-xs" />
                        <input type="checkbox" checked="checked" class="checkbox" />
                    </div>
                </div>
                <div class="diff-resizer"></div>
            </div>

            <p class="card-title mt-10">تغییر رمز ورود</p>
            <form id="passwordForm" class="w-[100%] flex md:flex flex-col items-start md:justify-start justify-center gap-6">
                <input type="password" name="current_password" id="current_password" class="input input-bordered w-full max-w-xs" placeholder="رمز قبلی" />
                <input type="password" class="input input-bordered w-full max-w-xs" placeholder="رمز جدید" />
                <input type="password" name="new_password" id="new_password" class="input input-bordered w-full max-w-xs" placeholder="تکرار رمز جدید" />
                <p id="passResponse"></p>
                <button type="submit" class="btn btn-neutral">تغییر رمز</button>
            </form>

            <a href="../index.html"><button class="btn btn-error text-white mb-5 mt-10">خروج از حساب کاربری</button></a>
        </div>
    </div>
</body>

<script type="module">
    function getDark() {
        const name = "darkMode=";
        const decodedCookie = decodeURIComponent(document.cookie);
        const cookieArray = decodedCookie.split(';');
        for (let i = 0; i < cookieArray.length; i++) {
            let cookie = cookieArray[i].trim();
            if (cookie.indexOf(name) === 0) {
                return cookie.substring(name.length, cookie.length);
            }
        }
    }
    const controller = document.getElementById("themeController")

    if (!getDark()){
        document.cookie = "darkMode="+false;
    }
    if (getDark() == 'true'){
        controller.checked = true
        const html = document.getElementById("html")
        html.setAttribute('data-theme', 'dark')
    } else if (getDark() == 'false'){
        controller.checked = false
        const html = document.getElementById("html")
        html.setAttribute('data-theme', 'light')
    }

    controller.addEventListener('change', function(event){
        document.cookie = "darkMode="+controller.checked;
    })
    
</script>

<script type="module">
    import {checkApi,getAccessCookie} from '../api.js'
    checkApi()
    const access = getAccessCookie()
    const url = 'http://127.0.0.1:8000/auth/users/me/'
    const form = document.getElementById('form');
    
    fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization':'JWT '+access
            },
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            form.first_name.value = data.first_name
            form.last_name.value = data.last_name
            form.email.value = data.email
            form.age.value = data.age
            form.province.value = data.province
            document.getElementById("nameLoc").innerText = data.first_name
        })
        .catch(error => {
            console.error('Error:', error);
    });

    form.addEventListener('submit', function(event) {
        event.preventDefault()
        
        const formData = new FormData(form);
        const formDataObject = Object.fromEntries(formData.entries());
        const formToSend = {email:formDataObject.email, first_name:formDataObject.first_name, last_name:formDataObject.last_name, }

        fetch(url, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'Authorization':'JWT '+ access,
            },
            body: JSON.stringify(formDataObject)
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {

        })
        .catch(error => {
            console.error('Error:', error);
        })
    })

    const passwordForm = document.getElementById('passwordForm');
    passwordForm.addEventListener('submit', function(event) {
        event.preventDefault()
        
        const Data = new FormData(passwordForm);
        const DataObject = Object.fromEntries(Data.entries());
        console.log(DataObject)

        const passurl = 'http://127.0.0.1:8000/auth/users/set_password/'
        fetch(passurl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization':'JWT '+ access
            },
            body: JSON.stringify(DataObject)
        })
        .then(response => {
            if (response.ok) {
                const res = document.getElementById("passResponse")
                res.innerHTML = 'رمز با موفقیت تغییر یافت'
                res.style.color = 'green'
                return response.json();
            }
            const res = document.getElementById("passResponse")
            res.innerHTML = 'رمز تغییر نیافت'
            res.style.color = 'red'
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            
        })
        .catch(error => {
            console.error('Error:', error);
        })
    })
</script>
</html>